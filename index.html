<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>微信表情包/横幅批量生成器</title>
    
    <!-- 1. 引入 Tailwind CSS (样式库) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. 引入 React 和 ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 3. 引入 Babel (用于在浏览器中解析 JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 4. 引入 JSZip (用于打包下载) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <style>
        /* 自定义一些动画 */
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">
    <div id="root"></div>

    <script type="text/babel">
        // 获取 React Hooks
        const { useState, useEffect, useCallback } = React;

        // --- 图标组件 (内联 SVG 以避免依赖) ---
        const Icon = ({ path, size = 24, className = "" }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {path}
            </svg>
        );

        const Icons = {
            ImageIcon: (props) => <Icon {...props} path={<><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></>} />,
            Upload: (props) => <Icon {...props} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></>} />,
            Download: (props) => <Icon {...props} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></>} />,
            Settings: (props) => <Icon {...props} path={<><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></>} />,
            Plus: (props) => <Icon {...props} path={<><path d="M5 12h14"/><path d="M12 5v14"/></>} />,
            Trash2: (props) => <Icon {...props} path={<><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></>} />,
            X: (props) => <Icon {...props} path={<><path d="M18 6 6 18"/><path d="m6 6 12 12"/></>} />,
            RefreshCw: (props) => <Icon {...props} path={<><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></>} />,
            CheckCircle: (props) => <Icon {...props} path={<><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></>} />,
            FileImage: (props) => <Icon {...props} path={<><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><circle cx="10" cy="10" r="2"/><path d="m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22"/></>} />,
            Wand2: (props) => <Icon {...props} path={<><path d="m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z"/><path d="m14 7 3 3"/><path d="M5 6v4"/><path d="M19 14v4"/><path d="M10 2v2"/><path d="M7 8H3"/><path d="M21 16h-4"/><path d="M11 3H9"/></>} />,
            Package: (props) => <Icon {...props} path={<><path d="m16.5 9.4-9-5.19"/><path d="m21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" x2="12" y1="22.08" y2="12"/></>} />
        };

        // --- 主组件 ---
        const App = () => {
            const [items, setItems] = useState([]);
            
            // 设置状态
            const [targetSize, setTargetSize] = useState({ w: 240, h: 240 });
            const [quality, setQuality] = useState(0.9);
            const [paddingColor, setPaddingColor] = useState('transparent');
            const [removeWhiteBg, setRemoveWhiteBg] = useState(false);
            const [bgTolerance, setBgTolerance] = useState(20);
            const [isGlobalProcessing, setIsGlobalProcessing] = useState(false);
            const [isZipping, setIsZipping] = useState(false);
            
            // 清空确认状态
            const [clearConfirm, setClearConfirm] = useState(false);

            // 预设尺寸列表
            const sizePresets = [
                { w: 50, h: 50, label: '50x50 (图标)' },
                { w: 120, h: 120, label: '120x120' },
                { w: 240, h: 240, label: '240x240 (标准)' },
                { w: 300, h: 300, label: '300x300' },
                { w: 750, h: 400, label: '750x400 (横幅)' },
            ];

            const generateId = () => Math.random().toString(36).substr(2, 9);

            const addFiles = (files) => {
                const newItems = Array.from(files)
                .filter(file => file.type.match('image.*'))
                .map(file => ({
                    id: generateId(),
                    file,
                    originalUrl: null,
                    processedUrl: null,
                    size: 0,
                    status: 'pending',
                    name: file.name
                }));

                if (newItems.length === 0) {
                    if (files.length > 0) alert('请上传有效的图片文件');
                    return;
                }

                setItems(prev => [...prev, ...newItems]);
                
                newItems.forEach(item => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        setItems(prev => prev.map(i => 
                        i.id === item.id ? { ...i, originalUrl: e.target.result } : i
                        ));
                    };
                    reader.readAsDataURL(item.file);
                });
            };

            const handleFileUpload = (e) => {
                if (e.target.files) addFiles(e.target.files);
                e.target.value = '';
            };

            const handleDrop = (e) => {
                e.preventDefault();
                if (e.dataTransfer.files) addFiles(e.dataTransfer.files);
            };

            const processItemImage = useCallback(async (item, width, height, color, q, removeBg, tolerance) => {
                if (!item.originalUrl) return item;

                return new Promise((resolve) => {
                const img = new Image();
                img.src = item.originalUrl;
                
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // 设置画布尺寸
                    canvas.width = width;
                    canvas.height = height;
                    ctx.clearRect(0, 0, width, height);

                    // 1. 填充背景
                    if (color !== 'transparent') {
                        ctx.fillStyle = color;
                        ctx.fillRect(0, 0, width, height);
                    }

                    // 2. 计算缩放（保持长宽比，Contain模式）
                    const scale = Math.min(width / img.width, height / img.height);
                    const w = img.width * scale;
                    const h = img.height * scale;
                    // 居中显示
                    const x = (width - w) / 2;
                    const y = (height - h) / 2;

                    ctx.drawImage(img, x, y, w, h);

                    // 3. 去底逻辑
                    if (removeBg) {
                        const imageData = ctx.getImageData(0, 0, width, height);
                        const data = imageData.data;
                        const tol = tolerance || 20;

                        for (let i = 0; i < data.length; i += 4) {
                            const r = data[i];
                            const g = data[i + 1];
                            const b = data[i + 2];
                            if (r > 255 - tol && g > 255 - tol && b > 255 - tol) {
                                data[i + 3] = 0;
                            }
                        }
                        ctx.putImageData(imageData, 0, 0);
                    }

                    canvas.toBlob((blob) => {
                    if (blob) {
                        resolve({
                            ...item,
                            processedUrl: URL.createObjectURL(blob),
                            size: blob.size,
                            status: 'done'
                        });
                    } else {
                        resolve({ ...item, status: 'error' });
                    }
                    }, 'image/png', q);
                };
                img.onerror = () => resolve({ ...item, status: 'error' });
                });
            }, []);

            useEffect(() => {
                const processQueue = async () => {
                const itemsToProcess = items.filter(item => item.originalUrl && item.status === 'pending');
                
                if (itemsToProcess.length > 0) {
                    setIsGlobalProcessing(true);
                    const processedResults = await Promise.all(
                        itemsToProcess.map(item => processItemImage(item, targetSize.w, targetSize.h, paddingColor, quality, removeWhiteBg, bgTolerance))
                    );
                    
                    setItems(prev => prev.map(prevItem => {
                        const processed = processedResults.find(p => p.id === prevItem.id);
                        return processed || prevItem;
                    }));
                    setIsGlobalProcessing(false);
                }
                };

                processQueue();
            }, [items, targetSize, paddingColor, quality, removeWhiteBg, bgTolerance, processItemImage]);

            useEffect(() => {
                setItems(prev => prev.map(item => ({ ...item, status: 'pending' })));
            }, [targetSize, paddingColor, quality, removeWhiteBg, bgTolerance]);


            const formatSize = (bytes) => {
                if (bytes === 0) return '...';
                const k = 1024;
                const sizes = ['B', 'KB', 'MB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            };

            const removeItem = (id) => {
                setItems(prev => prev.filter(item => item.id !== id));
            };

            // 修正后的清空函数：不依赖 window.confirm，使用按钮状态二次确认
            const removeAll = () => {
                if (clearConfirm) {
                    setItems([]);
                    setClearConfirm(false);
                    // 确保重置文件输入框，允许重新上传同名文件
                    const fileInput = document.getElementById('fileInput');
                    if (fileInput) fileInput.value = '';
                } else {
                    setClearConfirm(true);
                    // 3秒后如果没有点击确认，自动恢复
                    setTimeout(() => setClearConfirm(false), 3000);
                }
            };

            const downloadItem = (item) => {
                if (!item.processedUrl) return;
                const link = document.createElement('a');
                link.href = item.processedUrl;
                // 文件名加上尺寸后缀
                link.download = `sticker_${item.name.replace(/\.[^/.]+$/, "")}_${targetSize.w}x${targetSize.h}.png`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const downloadAllZip = async () => {
                if (!window.JSZip) {
                    alert("JSZip 库加载失败，请检查网络");
                    return;
                }
                
                setIsZipping(true);
                const zip = new JSZip();
                const folder = zip.folder("wechat_stickers");

                let count = 0;
                
                for (const item of items) {
                if (item.processedUrl) {
                    try {
                    const response = await fetch(item.processedUrl);
                    const blob = await response.blob();
                    folder.file(`sticker_${item.name.replace(/\.[^/.]+$/, "")}_${targetSize.w}x${targetSize.h}.png`, blob);
                    count++;
                    } catch (e) {
                    console.error("Failed to zip item:", item.name);
                    }
                }
                }

                if (count > 0) {
                try {
                    const content = await zip.generateAsync({ type: "blob" });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(content);
                    link.download = "wechat_stickers.zip";
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                } catch (e) {
                    alert("打包失败，请重试");
                }
                } else {
                alert("没有可下载的图片");
                }
                setIsZipping(false);
            };

            // --- 渲染界面 ---
            return (
                <div className="min-h-screen bg-gray-50 text-gray-800 font-sans p-4 md:p-8">
                <div className="max-w-6xl mx-auto">
                    <header className="mb-8 text-center">
                    <div className="inline-flex items-center justify-center p-3 bg-green-500 text-white rounded-2xl shadow-lg mb-4">
                        <Icons.ImageIcon size={32} />
                    </div>
                    <h1 className="text-3xl font-bold text-gray-900 mb-2">微信表情包/横幅生成器</h1>
                    <p className="text-gray-500">支持标准表情(240x240)、图标(50x50)、横幅(750x400)等多种尺寸</p>
                    </header>

                    <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                    {/* 左侧：操作面板 */}
                    <div className="lg:col-span-4 space-y-6">
                        
                        {/* 上传区域 */}
                        <div 
                        className="border-4 border-dashed border-gray-200 rounded-3xl bg-white p-8 text-center transition-all hover:border-green-400 hover:bg-green-50 cursor-pointer group shadow-sm relative overflow-hidden"
                        onDragOver={(e) => e.preventDefault()}
                        onDrop={handleDrop}
                        onClick={() => document.getElementById('fileInput').click()}
                        >
                        <input 
                            type="file" 
                            id="fileInput" 
                            className="hidden" 
                            accept="image/*" 
                            multiple 
                            onChange={handleFileUpload} 
                        />
                        <div className="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                            <Icons.Plus size={32} />
                        </div>
                        <h3 className="text-lg font-semibold text-gray-700 mb-1">添加图片</h3>
                        <p className="text-gray-400 text-xs">支持批量 JPG, PNG, WEBP</p>
                        </div>

                        {/* 设置区域 */}
                        <div className="bg-white rounded-3xl shadow-sm border border-gray-100 p-6">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="font-bold text-lg flex items-center gap-2">
                                <Icons.Settings size={20} className="text-gray-400" />
                                参数设置
                                </h3>
                            </div>
                            
                            <div className="space-y-6">
                                <div>
                                <label className="block text-sm font-medium text-gray-600 mb-2">
                                    目标尺寸 (像素)
                                </label>
                                <div className="flex flex-wrap gap-2">
                                    {sizePresets.map(preset => (
                                    <button
                                        key={preset.label}
                                        onClick={() => setTargetSize({ w: preset.w, h: preset.h })}
                                        className={`py-2 px-3 rounded-xl text-xs font-medium border transition-all ${
                                        targetSize.w === preset.w && targetSize.h === preset.h
                                        ? 'bg-green-500 text-white border-green-500 shadow-md' 
                                        : 'bg-white text-gray-600 border-gray-200 hover:border-green-300'
                                        }`}
                                    >
                                        {preset.label}
                                    </button>
                                    ))}
                                </div>
                                <div className="mt-2 text-xs text-gray-400 text-right">
                                    当前: {targetSize.w} x {targetSize.h} px
                                </div>
                                </div>

                                <div>
                                <label className="block text-sm font-medium text-gray-600 mb-2">
                                    背景处理
                                </label>
                                <div className="flex gap-2 mb-3">
                                    <button 
                                    onClick={() => setPaddingColor('transparent')}
                                    className={`flex-1 py-2 rounded-xl text-xs font-medium border flex items-center justify-center gap-2 ${
                                        paddingColor === 'transparent' ? 'ring-2 ring-green-500 border-green-500 bg-green-50 text-green-700' : 'border-gray-200'
                                    }`}
                                    >
                                    <div className="w-3 h-3 rounded border bg-gray-100" style={{backgroundImage: 'linear-gradient(45deg, #ccc 25%, transparent 25%), linear-gradient(-45deg, #ccc 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #ccc 75%), linear-gradient(-45deg, transparent 75%, #ccc 75%)', backgroundSize: '4px 4px'}}></div>
                                    透明边缘
                                    </button>
                                    <button 
                                    onClick={() => setPaddingColor('white')}
                                    className={`flex-1 py-2 rounded-xl text-xs font-medium border flex items-center justify-center gap-2 ${
                                        paddingColor === 'white' ? 'ring-2 ring-green-500 border-green-500 bg-white text-gray-900' : 'border-gray-200'
                                    }`}
                                    >
                                    <div className="w-3 h-3 rounded border border-gray-300 bg-white"></div>
                                    白色边缘
                                    </button>
                                </div>

                                <div className={`p-3 rounded-xl border transition-colors ${removeWhiteBg ? 'bg-blue-50 border-blue-200' : 'bg-gray-50 border-transparent'}`}>
                                    <div className="flex items-center justify-between">
                                    <label className="flex items-center gap-2 cursor-pointer select-none">
                                        <div className={`w-5 h-5 rounded border flex items-center justify-center ${removeWhiteBg ? 'bg-blue-500 border-blue-500' : 'bg-white border-gray-300'}`}>
                                        {removeWhiteBg && <Icons.CheckCircle size={14} className="text-white" />}
                                        </div>
                                        <input 
                                        type="checkbox" 
                                        className="hidden"
                                        checked={removeWhiteBg}
                                        onChange={(e) => setRemoveWhiteBg(e.target.checked)}
                                        />
                                        <span className={`text-sm font-medium ${removeWhiteBg ? 'text-blue-700' : 'text-gray-600'}`}>
                                        去除白色背景 (简单)
                                        </span>
                                    </label>
                                    <Icons.Wand2 size={16} className={`${removeWhiteBg ? 'text-blue-500' : 'text-gray-400'}`} />
                                    </div>
                                    
                                    {removeWhiteBg && (
                                    <div className="mt-2 pt-2 border-t border-blue-100">
                                        <div className="flex justify-between text-xs text-blue-600 mb-1">
                                        <span>强度:弱</span>
                                        <span>强</span>
                                        </div>
                                        <input 
                                        type="range" 
                                        min="1" max="100" 
                                        value={bgTolerance} 
                                        onChange={(e) => setBgTolerance(parseInt(e.target.value))}
                                        className="w-full h-1.5 bg-blue-200 rounded-lg appearance-none cursor-pointer accent-blue-500"
                                        />
                                        <p className="text-[10px] text-blue-400 mt-1">适合原图是白底的情况，将白色变为透明</p>
                                    </div>
                                    )}
                                </div>
                                </div>

                                {items.length > 0 && (
                                <div className="pt-4 border-t border-gray-100 space-y-3">
                                    <button 
                                    onClick={downloadAllZip}
                                    disabled={isZipping}
                                    className={`w-full py-3 text-white rounded-xl font-bold shadow-md active:scale-95 transition-all flex items-center justify-center gap-2 ${
                                        isZipping ? 'bg-gray-400 cursor-not-allowed' : 'bg-green-600 hover:bg-green-700'
                                    }`}
                                    >
                                    {isZipping ? <Icons.RefreshCw className="animate-spin" size={18}/> : <Icons.Package size={18} />}
                                    {isZipping ? '正在打包...' : `打包下载全部 (${items.length})`}
                                    </button>
                                    <button 
                                    onClick={removeAll}
                                    className={`w-full py-2 rounded-xl text-sm font-medium flex items-center justify-center gap-2 transition-colors ${
                                        clearConfirm 
                                        ? 'bg-red-500 text-white hover:bg-red-600 shadow-md' 
                                        : 'text-red-500 hover:bg-red-50'
                                    }`}
                                    >
                                    <Icons.Trash2 size={16} />
                                    {clearConfirm ? '确定清空？' : '清空列表'}
                                    </button>
                                </div>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* 右侧：结果列表 */}
                    <div className="lg:col-span-8">
                        <div className="bg-white rounded-3xl shadow-lg border border-gray-100 p-6 min-h-[500px]">
                            <div className="flex justify-between items-center mb-6">
                            <h3 className="font-bold text-gray-800 flex items-center gap-2">
                                <Icons.FileImage size={20} className="text-green-500"/>
                                处理结果 ({items.length})
                            </h3>
                            {isGlobalProcessing && (
                                <span className="text-sm text-green-600 flex items-center gap-2 animate-pulse">
                                <Icons.RefreshCw size={14} className="animate-spin"/>
                                处理中...
                                </span>
                            )}
                            </div>

                            {items.length > 0 ? (
                            <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                                {items.map(item => (
                                <div key={item.id} className="relative group bg-gray-50 rounded-xl border border-gray-200 p-3 hover:shadow-md transition-shadow">
                                    <button 
                                    onClick={() => removeItem(item.id)}
                                    className="absolute top-2 right-2 z-10 p-1.5 bg-white text-gray-400 hover:text-red-500 rounded-full shadow-sm opacity-0 group-hover:opacity-100 transition-opacity"
                                    >
                                    <Icons.X size={14} />
                                    </button>

                                    {/* 预览容器：根据当前目标尺寸调整宽高比 */}
                                    <div 
                                        className="bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4IiBoZWlnaHQ9IjgiPgo8cmVjdCB3aWR0aD0iOCIgaGVpZ2h0PSI4IiBmaWxsPSIjZmZmIi8+CjxyZWN0IHdpZHRoPSI0IiBoZWlnaHQ9IjQiIGZpbGw9IiNlNWU1ZTUiLz4KPHJlY3QgeD0iNCIgeT0iNCIgd2lkdGg9IjQiIGhlaWdodD0iNCIgZmlsbD0iI2U1ZTVlNSIvPgo8L3N2Zz4=')] rounded-lg overflow-hidden flex items-center justify-center mb-3 border border-gray-100"
                                        style={{ aspectRatio: `${targetSize.w}/${targetSize.h}` }}
                                    >
                                    {item.processedUrl ? (
                                        <img src={item.processedUrl} alt="processed" className="max-w-full max-h-full object-contain" />
                                    ) : (
                                        <Icons.RefreshCw className="animate-spin text-gray-400" />
                                    )}
                                    </div>

                                    <div className="space-y-1">
                                    <div className="flex justify-between items-center text-xs text-gray-500">
                                        <span className="truncate max-w-[80px]" title={item.name}>{item.name}</span>
                                        <span className={`${item.size > 1024*1024 ? 'text-red-500 font-bold' : 'text-green-600'}`}>
                                        {formatSize(item.size)}
                                        </span>
                                    </div>
                                    
                                    <button
                                        onClick={() => downloadItem(item)}
                                        disabled={!item.processedUrl}
                                        className="w-full mt-2 py-1.5 bg-white border border-gray-200 hover:border-green-500 hover:text-green-600 text-gray-600 rounded-lg text-xs font-medium transition-colors flex items-center justify-center gap-1"
                                    >
                                        <Icons.Download size={12} />
                                        下载
                                    </button>
                                    </div>
                                </div>
                                ))}
                                
                                <div 
                                onClick={() => document.getElementById('fileInput').click()}
                                className="border-2 border-dashed border-gray-200 rounded-xl flex flex-col items-center justify-center text-gray-400 hover:border-green-400 hover:text-green-500 hover:bg-green-50 transition-colors cursor-pointer min-h-[160px]"
                                >
                                <Icons.Plus size={24} className="mb-2" />
                                <span className="text-sm font-medium">继续添加</span>
                                </div>
                            </div>
                            ) : (
                            <div className="h-64 flex flex-col items-center justify-center text-gray-300 border-2 border-dashed border-gray-100 rounded-2xl">
                                <p className="text-sm">暂无图片，请在左侧添加</p>
                            </div>
                            )}
                        </div>
                    </div>
                    </div>
                    
                    <div className="mt-12 text-center text-gray-400 text-sm">
                    <p>注意：“去除白色背景”会将图片中接近白色的部分变为透明，如果主体包含白色可能会被误删，请调节强度滑块。</p>
                    </div>
                </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
